#!/bin/bash
set -eu

# Reset venv
venv="orgee-roam"
python_version="3.10.8"
if [[ $(pyenv versions | grep "$venv") ]]; then
	pyenv virtualenv-delete -f $venv
fi
pyenv virtualenv $python_version $venv
eval "$(pyenv init -)"
eval "$(pyenv virtualenv-init -)"

pyenv activate $venv

# Create .pth file
PTHS=(
	"$PROJECT_ROOT/src"
)
fn=$(python -c "from distutils.sysconfig import get_python_lib; print(get_python_lib())")/venv.pth
echo "Write in file $fn"
echo "# Site packages for virtualenv $venv" >"$fn"
for pth in "${PTHS[@]}"; do
	realpath "$pth" >>"$fn"
done

# Install dependencies
PACKAGES=(
  # Dev dependencies
	black # Formatter
	mypy # typing linter
	pylint # linter
  twine # to publish to pypi
  pytest # testing framework
  # Package dependencies
  python-slugify[unidecode]
  wikipedia-api
  orgee
  kombini
)
pip install --upgrade pip
pip install wheel
pip install "${PACKAGES[@]}"

# Install jupyter kernel
pip install ipykernel
ipython kernel install --user --name=$venv
