#+title: Testo
#+property: header-args:jupyter-python :kernel orgee-roam :session testo

* Init
#+begin_src jupyter-python :async yes
import logging, sys, time
from IPython import get_ipython

# Display stderr messages in output
sys.stderr = sys.stdout
# Setup root logger format
logging.basicConfig(
    level=logging.INFO,  # default is WARNING
    format="%(asctime)s-%(module)s[%(funcName)s:%(lineno)s]\n"
    "%(levelname)s-%(message)s",
)
# Enable auto-reload of imported code
ipy = get_ipython()
if "IPython.extensions.autoreload" not in sys.modules:
    ipy.run_line_magic("load_ext", "autoreload")
# Set external code to reload before each exec
ipy.run_line_magic("autoreload", "2")


def runf(func):
    t0 = time.time()
    r = func()
    print(f"Task finished in {time.time()-t0:.2f}s")
    return r


print("Init done")
#+end_src

#+RESULTS:
: Init done

* Load local config file
#+begin_src jupyter-python :async yes
def func():
    # pylint: disable=import-outside-toplevel
    import pprint
    from orgee_roam.config import get_config

    pprint.pprint(get_config())


runf(func)  # pylint: disable=undefined-variable
#+end_src

#+RESULTS:
: ({'roam_cache': '/home/chunglak/.emacs.d/orgzettel-cache.json',
:   'zettelkasten_root': '/home/chunglak/monobox/zettel'},
:  '/home/chunglak/.orgee-roam.ini')
: Task finished in 0.01s

* Zettelkasten
#+begin_src jupyter-python :async yes
def func():
    # pylint: disable=import-outside-toplevel
    from orgee_roam.zettelkasten import ZettelKasten

    zk = ZettelKasten()
    zs = zk.zettels()
    print(len(list(zs)))


runf(func)  # pylint: disable=undefined-variable
#+end_src

#+RESULTS:
: 33974
: Task finished in 1.45s

* Add zettel
#+begin_src jupyter-python :async yes
def func():
    # pylint: disable=import-outside-toplevel
    from orgee_roam.zettelkasten import ZettelKasten

    zk = ZettelKasten()
    z = zk.create_zettel(title="My testo")
    print(z)


runf(func)  # pylint: disable=undefined-variable
#+end_src

#+RESULTS:
: 2022-12-25 23:26:14,701-create_zettel[create_zettel:85]
: INFO-Created file /home/chunglak/monobox/zettel/20221225232614-my-testo.org for node My testo
: 2022-12-25 23:26:29,267-zettelkasten_cache[update_cache:157]
: INFO-Adding «My testo»
: 2022-12-25 23:26:29,268-zettelkasten_cache[update_cache:160]
: INFO-1 node changed
: Zettel(uuid='52d84ec4-236b-4194-9c68-8080ba98848e', title='My testo', filename='/home/chunglak/monobox/zettel/20221225232614-my-testo.org', updated_ts=1671978374.7031791, lastchecked_ts=1671978374.7031791, zettel_hash='1e05cb4da8608fc6a38e64d876315dab3436ae92e941dcf8c117214fb1095ad0', level=0, lineno=1, tags=set(), all_tags=set(), aliases=set(), olp=['My testo'], properties=[('ID', '52d84ec4-236b-4194-9c68-8080ba98848e'), ('CREATED_TS', '1671978374')])
: Task finished in 18.88s

* Make finder
#+begin_src jupyter-python :async yes
def func():
    # pylint: disable=import-outside-toplevel
    from orgee_roam.zettel_finder import ZettelFinder

    zf = ZettelFinder()
    zf.make_finder_files()


runf(func)  # pylint: disable=undefined-variable
#+end_src

#+RESULTS:
: 2022-12-26 00:02:12,347-create_zettel[create_zettel:85]
: INFO-Created file /home/chunglak/monobox/zettel/zettel-finder-new.org for node Nodes by updated timestamp (33974 zettels)
: 2022-12-26 00:02:15,176-zettel_list[make_list:47]
: INFO-Saved 33974 links to /home/chunglak/monobox/zettel/zettel-finder-new.org
: 2022-12-26 00:02:15,195-create_zettel[create_zettel:85]
: INFO-Created file /home/chunglak/monobox/zettel/zettel-finder-restricted-new.org for node Restricted nodes by updated timestamp (3994 zettels)
: 2022-12-26 00:02:15,479-zettel_list[make_list:47]
: INFO-Saved 3994 links to /home/chunglak/monobox/zettel/zettel-finder-restricted-new.org
: Task finished in 4.59s

* Func
#+begin_src jupyter-python :async yes
def func():
    # pylint: disable=import-outside-toplevel
    pass


runf(func)  # pylint: disable=undefined-variable
#+end_src
